<?xml version="1.0" encoding="utf-8" ?>
<Patch>

	<!-- ========== Projectile thingClass ========== -->

	<Operation Class="PatchOperationReplace">
		<xpath>Defs/ThingDef[defName="Proj_BaegYa"]/thingClass</xpath>
		<value>
			<thingClass>CombatExtended.ProjectileCE_Explosive</thingClass>
		</value>
	</Operation>	
	
	<Operation Class="PatchOperationReplace">
		<xpath>Defs/ThingDef[defName="Proj_Dunder"]/thingClass</xpath>
		<value>
			<thingClass>CombatExtended.ProjectileCE_Explosive</thingClass>
		</value>
	</Operation>		
	
	<Operation Class="PatchOperationReplace">
		<xpath>Defs/ThingDef[defName="Proj_Bobcat"]/thingClass</xpath>
		<value>
			<thingClass>CombatExtended.ProjectileCE_Explosive</thingClass>
		</value>
	</Operation>		
	
	<Operation Class="PatchOperationReplace">
		<xpath>Defs/ThingDef[defName="Proj_Grief"]/thingClass</xpath>
		<value>
			<thingClass>CombatExtended.ProjectileCE_Explosive</thingClass>
		</value>
	</Operation>		
	
	<!-- ========== Projectile ========== -->	
	
	<Operation Class="PatchOperationReplace">
		<xpath>Defs/ThingDef[defName="Proj_BaegYa"]/projectile</xpath>
		<value>
			<projectile Class="CombatExtended.ProjectilePropertiesCE">
			  <explosionRadius>1.5</explosionRadius>
			  <damageDef>Bomb</damageDef>
			  <damageAmountBase>50</damageAmountBase>
			  <explosionDelay>60</explosionDelay>
			  <dropsCasings>true</dropsCasings>
			  <casingMoteDefname>Mote_GrenadePin</casingMoteDefname>
      	<applyDamageToExplosionCellsNeighbors>true</applyDamageToExplosionCellsNeighbors>
			</projectile>
		</value>
	</Operation>	
	
	<Operation Class="PatchOperationReplace">
		<xpath>Defs/ThingDef[defName="Proj_Dunder"]/projectile</xpath>
		<value>
			<projectile Class="CombatExtended.ProjectilePropertiesCE">
			  <explosionRadius>1.5</explosionRadius>
			  <damageDef>Bomb</damageDef>
			  <damageAmountBase>50</damageAmountBase>
			  <explosionDelay>60</explosionDelay>
			  <dropsCasings>true</dropsCasings>
			  <casingMoteDefname>Mote_GrenadePin</casingMoteDefname>
      	<applyDamageToExplosionCellsNeighbors>true</applyDamageToExplosionCellsNeighbors>
			</projectile>
		</value>
	</Operation>	
	
	<Operation Class="PatchOperationReplace">
		<xpath>Defs/ThingDef[defName="Proj_Bobcat"]/projectile</xpath>
		<value>
			<projectile Class="CombatExtended.ProjectilePropertiesCE">
			  <explosionRadius>1.5</explosionRadius>
			  <damageDef>Bomb</damageDef>
			  <damageAmountBase>50</damageAmountBase>
			  <explosionDelay>60</explosionDelay>
			  <dropsCasings>true</dropsCasings>
			  <casingMoteDefname>Mote_GrenadePin</casingMoteDefname>
      	<applyDamageToExplosionCellsNeighbors>true</applyDamageToExplosionCellsNeighbors>
			</projectile>
		</value>
	</Operation>	
	
	<Operation Class="PatchOperationReplace">
		<xpath>Defs/ThingDef[defName="Proj_Grief"]/projectile</xpath>
		<value>
			<projectile Class="CombatExtended.ProjectilePropertiesCE">
			  <explosionRadius>1.5</explosionRadius>
			  <damageDef>Bomb</damageDef>
			  <damageAmountBase>50</damageAmountBase>
			  <explosionDelay>60</explosionDelay>
			  <dropsCasings>true</dropsCasings>
			  <casingMoteDefname>Mote_GrenadePin</casingMoteDefname>
      	<applyDamageToExplosionCellsNeighbors>true</applyDamageToExplosionCellsNeighbors>
			</projectile>
		</value>
	</Operation>	

	<!-- ========== Check Comp ========== -->		

	<Operation Class="PatchOperationSequence">
  	<success>Always</success>
  	<operations>
    	<li Class="PatchOperationTest">
      	<xpath>Defs/ThingDef[defName="Proj_BaegYa"]/comps</xpath>
      	<success>Invert</success>
    	</li>
    	<li Class="PatchOperationAdd">
      	<xpath>Defs/ThingDef[defName="Proj_BaegYa"]</xpath>
      	<value>
        	<comps />
      	</value>
    	</li>
  	</operations>
	</Operation>

	<Operation Class="PatchOperationSequence">
  	<success>Always</success>
  	<operations>
    	<li Class="PatchOperationTest">
      	<xpath>Defs/ThingDef[defName="Proj_Dunder"]/comps</xpath>
      	<success>Invert</success>
    	</li>
    	<li Class="PatchOperationAdd">
      	<xpath>Defs/ThingDef[defName="Proj_Dunder"]</xpath>
      	<value>
        	<comps />
      	</value>
    	</li>
  	</operations>
	</Operation>	

	<Operation Class="PatchOperationSequence">
  	<success>Always</success>
  	<operations>
    	<li Class="PatchOperationTest">
      	<xpath>Defs/ThingDef[defName="Proj_Bobcat"]/comps</xpath>
      	<success>Invert</success>
    	</li>
    	<li Class="PatchOperationAdd">
      	<xpath>Defs/ThingDef[defName="Proj_Bobcat"]</xpath>
      	<value>
        	<comps />
      	</value>
    	</li>
  	</operations>
	</Operation>	
	
	<Operation Class="PatchOperationSequence">
  	<success>Always</success>
  	<operations>
    	<li Class="PatchOperationTest">
      	<xpath>Defs/ThingDef[defName="Proj_Grief"]/comps</xpath>
      	<success>Invert</success>
    	</li>
    	<li Class="PatchOperationAdd">
      	<xpath>Defs/ThingDef[defName="Proj_Grief"]</xpath>
      	<value>
        	<comps />
      	</value>
    	</li>
  	</operations>
	</Operation>		
	
	<!-- ========== Add Fragmentation ========== -->		
	
	<Operation Class="PatchOperationAdd">
		<xpath>Defs/ThingDef[defName="Proj_GrenadeFrag"]/comps</xpath>
		<value>
			<li Class="CombatExtended.CompProperties_ExplosiveCE">
			  <fragments>
			    <Fragment_GrenadeFrag>250</Fragment_GrenadeFrag>
			  </fragments>
			</li>
		</value>
	</Operation>

	<!-- Grenade -->

	<Operation Class="PatchOperationReplace">
		<xpath>Defs/ThingDef[defName="Weapon_GrenadeFrag"]/label</xpath>
		<value>
			<label>frag grenade</label>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>Defs/ThingDef[defName="Weapon_GrenadeFrag"]/graphicData</xpath>
		<value>
			<graphicData>
			  <texPath>Things/Ammo/HandGrenades/Frag</texPath>
			  <graphicClass>Graphic_StackCount</graphicClass>
			  <onGroundRandomRotateAngle>0</onGroundRandomRotateAngle>
			</graphicData>
		</value>
	</Operation>

	<Operation Class="PatchOperationAdd">
		<xpath>Defs/ThingDef[defName="Weapon_GrenadeFrag"]</xpath>
		<value>
			<thingClass>CombatExtended.AmmoThing</thingClass>
			<stackLimit>75</stackLimit>
			<resourceReadoutPriority>First</resourceReadoutPriority>
		</value>
	</Operation>

	<Operation Class="PatchOperationAttributeSet">
		<xpath>Defs/ThingDef[defName="Weapon_GrenadeFrag"]</xpath>
		<attribute>Class</attribute>
		<value>CombatExtended.AmmoDef</value>
	</Operation>

	<Operation Class="PatchOperationSequence">
  	<success>Always</success>
  	<operations>
    	<li Class="PatchOperationTest">
      	<xpath>Defs/ThingDef[defName="Weapon_GrenadeFrag"]/comps</xpath>
      	<success>Invert</success>
    	</li>
    	<li Class="PatchOperationAdd">
      	<xpath>Defs/ThingDef[defName="Weapon_GrenadeFrag"]</xpath>
      	<value>
        	<comps />
      	</value>
    	</li>
  	</operations>
	</Operation>

	<Operation Class="PatchOperationAdd">
		<xpath>Defs/ThingDef[defName="Weapon_GrenadeFrag"]/comps</xpath>
		<value>
			<li Class="CombatExtended.CompProperties_ExplosiveCE">
			  <explosionDamage>40</explosionDamage>
			  <explosionDamageDef>Bomb</explosionDamageDef>
			  <explosionRadius>1.5</explosionRadius>
			  <fragments>
			    <Fragment_GrenadeFrag>250</Fragment_GrenadeFrag>
			  </fragments>
			</li>
		</value>
	</Operation>

  <Operation Class="CombatExtended.PatchOperationMakeGunCECompatible">
    <defName>Weapon_GrenadeFrag</defName>
    <statBases>
			<Mass>0.4</Mass>
			<MarketValue>5.25</MarketValue>
			<RangedWeapon_Cooldown>1</RangedWeapon_Cooldown>
			<SightsEfficiency>1</SightsEfficiency>
    </statBases>
    <Properties>
    	<label>throw frag grenade</label>
    	<verbClass>CombatExtended.Verb_ShootCEOneUse</verbClass>
    	<hasStandardCommand>true</hasStandardCommand>
    	<range>10.0</range>
      <minRange>4</minRange>
    	<warmupTime>0.8</warmupTime>
    	<noiseRadius>4</noiseRadius>
    	<ai_IsBuildingDestroyer>true</ai_IsBuildingDestroyer>
    	<soundCast>ThrowGrenade</soundCast>
    	<targetParams>
    	  <canTargetLocations>true</canTargetLocations>
    	</targetParams>
    	<defaultProjectile>Proj_GrenadeFrag</defaultProjectile>
    	<onlyManualCast>true</onlyManualCast>
      <ignorePartialLoSBlocker>true</ignorePartialLoSBlocker>
    </Properties>
    <weaponTags>
			<li>CE_AI_Grenade</li>
			<li>CE_OneHandedWeapon</li>
    </weaponTags>
  </Operation>

</Patch>